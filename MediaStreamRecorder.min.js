'use strict';

// Last time updated: 2019-04-08 4:03:23 AM UTC

// __________________________
// MediaStreamRecorder v1.3.5

// Open-Sourced: https://github.com/streamproc/MediaStreamRecorder

// --------------------------------------------------
// Muaz Khan     - www.MuazKhan.com
// MIT License   - www.WebRTC-Experiment.com/licence
// --------------------------------------------------

"use strict";function MediaStreamRecorder(i){if(!i)throw"MediaStream is mandatory.";var o;this.start=function(e){var t;"undefined"!=typeof MediaRecorder?t=MediaRecorderWrapper:(IsChrome||IsOpera||IsEdge)&&(-1!==this.mimeType.indexOf("video")?t=WhammyRecorder:-1!==this.mimeType.indexOf("audio")&&(t=StereoAudioRecorder)),"image/gif"===this.mimeType&&(t=GifRecorder),"audio/wav"!==this.mimeType&&"audio/pcm"!==this.mimeType||(t=StereoAudioRecorder),this.recorderType&&(t=this.recorderType),(o=new t(i)).blobs=[];var a=this;o.ondataavailable=function(e){o.blobs.push(e),a.ondataavailable(e)},o.onstop=this.onstop,o.onStartedDrawingNonBlankFrames=this.onStartedDrawingNonBlankFrames,(o=mergeProps(o,this)).start(e)},this.onStartedDrawingNonBlankFrames=function(){},this.clearOldRecordedFrames=function(){o&&o.clearOldRecordedFrames()},this.stop=function(){o&&o.stop()},this.ondataavailable=function(e){console.log("ondataavailable..",e)},this.onstop=function(e){console.warn("stopped..",e)},this.save=function(e,t){if(e)invokeSaveAsDialog(e,t);else{if(!o)return;ConcatenateBlobs(o.blobs,o.blobs[0].type,function(e){invokeSaveAsDialog(e)})}},this.pause=function(){o&&(o.pause(),console.log("Paused recording.",this.mimeType||o.mimeType))},this.resume=function(){o&&(o.resume(),console.log("Resumed recording.",this.mimeType||o.mimeType))},this.recorderType=null,this.mimeType="video/webm",this.disableLogs=!1}function MultiStreamRecorder(i){if(!i)throw"MediaStream is mandatory.";var o,r,n=this,d=isMediaRecorderCompatible();this.stream=i,this.start=function(e){for(var t in o=new MediaStreamRecorder(i),r=new MediaStreamRecorder(i),o.mimeType="audio/ogg",r.mimeType="video/webm",this)"function"!=typeof this[t]&&(o[t]=r[t]=this[t]);function a(e){c++,n.ondataavailable(e)}o.ondataavailable=function(e){s[c]||(s[c]={}),s[c].audio=e,s[c].video&&!s[c].onDataAvailableEventFired&&(s[c].onDataAvailableEventFired=!0,a(s[c]))},r.ondataavailable=function(e){if(d)return n.ondataavailable({video:e,audio:e});s[c]||(s[c]={}),s[c].video=e,s[c].audio&&!s[c].onDataAvailableEventFired&&(s[c].onDataAvailableEventFired=!0,a(s[c]))},r.onstop=o.onstop=function(e){n.onstop(e)},d||(r.onStartedDrawingNonBlankFrames=function(){r.clearOldRecordedFrames(),o.start(e)}),r.start(e)},this.stop=function(){o&&o.stop(),r&&r.stop()},this.ondataavailable=function(e){console.log("ondataavailable..",e)},this.onstop=function(e){console.warn("stopped..",e)},this.pause=function(){o&&o.pause(),r&&r.pause()},this.resume=function(){o&&o.resume(),r&&r.resume()};var s={},c=0}void 0!==MediaStreamRecorder&&(MediaStreamRecorder.MultiStreamRecorder=MultiStreamRecorder);var AudioContext,browserFakeUserAgent="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";!function(e){"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}},e.window=global),"undefined"==typeof document&&(e.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){return{}}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}))}("undefined"!=typeof global?global:window),void 0===(AudioContext=window.AudioContext)&&("undefined"!=typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(AudioContext=mozAudioContext)),"undefined"==typeof window&&(window={}),void 0===(AudioContext=window.AudioContext)&&("undefined"!=typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(AudioContext=mozAudioContext));var URL=window.URL;void 0===URL&&"undefined"!=typeof webkitURL&&(URL=webkitURL),"undefined"!=typeof navigator?(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia)):navigator={getUserMedia:function(){},userAgent:browserFakeUserAgent};var IsEdge=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),IsOpera=!1;"undefined"!=typeof opera&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("OPR/")&&(IsOpera=!0);var IsChrome=!IsEdge&&!IsEdge&&!!navigator.webkitGetUserMedia,MediaStream=window.MediaStream;function mergeProps(e,t){for(var a in t)"function"!=typeof t[a]&&(e[a]=t[a]);return e}function dropFirstFrame(e){return e.shift(),e}function invokeSaveAsDialog(e,t){if(!e)throw"Blob object is required.";if(!e.type)try{e.type="video/webm"}catch(e){}var a=(e.type||"video/webm").split("/")[1];if(t&&-1!==t.indexOf(".")){var i=t.split(".");t=i[0],a=i[1]}var o=(t||Math.round(9999999999*Math.random())+888888888)+"."+a;if(void 0!==navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(e,o);if(void 0!==navigator.msSaveBlob)return navigator.msSaveBlob(e,o);var r=document.createElement("a");r.href=URL.createObjectURL(e),r.target="_blank",r.download=o,navigator.mozGetUserMedia&&(r.onclick=function(){(document.body||document.documentElement).removeChild(r)},(document.body||document.documentElement).appendChild(r));var n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});r.dispatchEvent(n),navigator.mozGetUserMedia||URL.revokeObjectURL(r.href)}function bytesToSize(e){if(0===e)return"0 Bytes";var t=parseInt(Math.floor(Math.log(e)/Math.log(1e3)),10);return(e/Math.pow(1e3,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][t]}void 0===MediaStream&&"undefined"!=typeof webkitMediaStream&&(MediaStream=webkitMediaStream),void 0!==MediaStream&&("getVideoTracks"in MediaStream.prototype||(MediaStream.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var t=[];return this.getTracks.forEach(function(e){-1!==e.kind.toString().indexOf("video")&&t.push(e)}),t},MediaStream.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var t=[];return this.getTracks.forEach(function(e){-1!==e.kind.toString().indexOf("audio")&&t.push(e)}),t}),"stop"in MediaStream.prototype||(MediaStream.prototype.stop=function(){this.getAudioTracks().forEach(function(e){e.stop&&e.stop()}),this.getVideoTracks().forEach(function(e){e.stop&&e.stop()})})),"undefined"!=typeof location&&0===location.href.indexOf("file:")&&console.error("Please load this HTML file on HTTP or HTTPS.");var ObjectStore={AudioContext:AudioContext};function isMediaRecorderCompatible(){var e=!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),t=!!window.chrome&&!e;if(void 0!==window.InstallTrigger)return!0;if(!t)return!1;navigator.appVersion;var a,i,o=navigator.userAgent,r=""+parseFloat(navigator.appVersion),n=parseInt(navigator.appVersion,10);return t&&(a=o.indexOf("Chrome"),r=o.substring(a+7)),-1!==(i=r.indexOf(";"))&&(r=r.substring(0,i)),-1!==(i=r.indexOf(" "))&&(r=r.substring(0,i)),n=parseInt(""+r,10),isNaN(n)&&(r=""+parseFloat(navigator.appVersion),n=parseInt(navigator.appVersion,10)),49<=n}ObjectStore={AudioContext:window.AudioContext||window.webkitAudioContext};function MediaRecorderWrapper(r){var n,d=this;this.start=function(a,e){var t;(d.mimeType||(d.mimeType="video/webm"),-1!==d.mimeType.indexOf("audio"))&&(r.getVideoTracks().length&&r.getAudioTracks().length&&(navigator.mozGetUserMedia?(t=new MediaStream).addTrack(r.getAudioTracks()[0]):t=new MediaStream(r.getAudioTracks()),r=t));-1!==d.mimeType.indexOf("audio")&&(d.mimeType=IsChrome?"audio/webm":"audio/ogg"),d.dontFireOnDataAvailableEvent=!1;var i={mimeType:d.mimeType};d.disableLogs||e||console.log("Passing following params over MediaRecorder API.",i),n&&(n=null),IsChrome&&!isMediaRecorderCompatible()&&(i="video/vp8");try{n=new MediaRecorder(r,i)}catch(e){n=new MediaRecorder(r)}"canRecordMimeType"in n&&!1===n.canRecordMimeType(d.mimeType)&&(d.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",d.mimeType)),n.ignoreMutedMedia=d.ignoreMutedMedia||!1;var o=!1;n.ondataavailable=function(e){if(!d.dontFireOnDataAvailableEvent&&e.data&&e.data.size&&!(e.data.size<26800)&&!o){o=!0;var t=d.getNativeBlob?e.data:new Blob([e.data],{type:d.mimeType||"video/webm"});d.ondataavailable(t),d.dontFireOnDataAvailableEvent=!0,n&&(n.stop(),n=null),d.start(a,"__disableLogs")}},n.onerror=function(e){d.disableLogs||("InvalidState"===e.name?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed."):"OutOfMemory"===e.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute."):"IllegalStreamModification"===e.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute."):"OtherRecordingError"===e.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute."):"GenericError"===e.name?console.error("The UA cannot provide the codec or recording option that has been requested.",e):console.error("MediaRecorder Error",e)),n&&"inactive"!==n.state&&"stopped"!==n.state&&n.stop()};try{n.start(36e5)}catch(e){n=null}setTimeout(function(){n&&"recording"===n.state&&n.requestData()},a)},this.stop=function(e){n&&"recording"===n.state&&(n.requestData(),setTimeout(function(){d.dontFireOnDataAvailableEvent=!0,n&&"recording"===n.state&&n.stop(),n=null},2e3))},this.pause=function(){n&&"recording"===n.state&&n.pause()},this.ondataavailable=function(e){console.log("recorded-blob",e)},this.resume=function(){if(this.dontFireOnDataAvailableEvent){this.dontFireOnDataAvailableEvent=!1;var e=d.disableLogs;return d.disableLogs=!0,this.record(),void(d.disableLogs=e)}n&&"paused"===n.state&&n.resume()},this.clearRecordedData=function(){n&&(this.pause(),this.dontFireOnDataAvailableEvent=!0,this.stop())},function e(){n&&(!1!==function(){if("active"in r){if(!r.active)return!1}else if("ended"in r&&r.ended)return!1;return!0}()?setTimeout(e,1e3):d.stop())}()}function StereoAudioRecorder(t){var a,i;this.start=function(e){e=e||1e3,(a=new StereoAudioRecorderHelper(t,this)).record(),i=setInterval(function(){a.requestData()},e)},this.stop=function(){a&&(a.stop(),clearTimeout(i))},this.pause=function(){a&&a.pause()},this.resume=function(){a&&a.resume()},this.ondataavailable=function(){}}function StereoAudioRecorderHelper(e,h){var t;ObjectStore.AudioContextConstructor||(ObjectStore.AudioContextConstructor=new ObjectStore.AudioContext),t=ObjectStore.AudioContextConstructor.sampleRate;var a,l=[],m=[],f=!1,p=0,v=h.sampleRate||t,g=-1<(h.mimeType||"audio/wav").indexOf("audio/pcm"),b=h.audioChannels||2;function w(e,t){for(var a=new Float32Array(t),i=0,o=e.length,r=0;r<o;r++){var n=e[r];a.set(n,i),i+=n.length}return a}function y(e,t,a){for(var i=a.length,o=0;o<i;o++)e.setUint8(t+o,a.charCodeAt(o))}this.record=function(){f=!0,l.length=m.length=0,p=0},this.requestData=function(){if(!A)if(f)h.ondataavailable(!1);else if(0!==p){S=!0;var e=l.slice(0),t=m.slice(0),a=p;l.length=m.length=[],p=0,S=!1;var i=w(e,a),o=i;if(2===b)o=function(e,t){for(var a=e.length+t.length,i=new Float32Array(a),o=0,r=0;r<a;)i[r++]=e[o],i[r++]=t[o],o++;return i}(i,w(t,a));if(g){var r=new Blob([function(e){var t=e.length,a=new Int16Array(t);for(;t--;)a[t]=65535*e[t];return a.buffer}(o)],{type:"audio/pcm"});return console.debug("audio recorded blob size:",bytesToSize(r.size)),void h.ondataavailable(r)}var n=new ArrayBuffer(44+2*o.length),d=new DataView(n);y(d,0,"RIFF"),d.setUint32(4,44+2*o.length-8,!0),y(d,8,"WAVE"),y(d,12,"fmt "),d.setUint32(16,16,!0),d.setUint16(20,1,!0),d.setUint16(22,b,!0),d.setUint32(24,v,!0),d.setUint32(28,v*b*2,!0),d.setUint16(32,2*b,!0),d.setUint16(34,16,!0),y(d,36,"data"),d.setUint32(40,2*o.length,!0);for(var s=o.length,c=44,u=0;u<s;u++)d.setInt16(c,32767*o[u],!0),c+=2;r=new Blob([d],{type:"audio/wav"});console.debug("audio recorded blob size:",bytesToSize(r.size)),h.ondataavailable(r),h.onstop(),M.disconnect()}else S=!1},this.stop=function(){f=!1,this.requestData()};var i=ObjectStore.AudioContextConstructor;ObjectStore.VolumeGainNode=i.createGain();var M,o=ObjectStore.VolumeGainNode;ObjectStore.AudioInput=i.createMediaStreamSource(e),(M=ObjectStore.AudioInput).connect(o);var r=h.bufferSize||2048;if(0===h.bufferSize&&(r=0),i.createJavaScriptNode)a=i.createJavaScriptNode(r,b,b);else{if(!i.createScriptProcessor)throw"WebAudio API has no support on this browser.";a=i.createScriptProcessor(r,b,b)}r=a.bufferSize,console.debug("using audio buffer-size:",r);var S=!1;window.scriptprocessornode=a,1===b&&console.debug("All right-channels are skipped.");var A=!1;this.pause=function(){A=!0},this.resume=function(){A=!1},a.onaudioprocess=function(e){if(f&&!S&&!A){var t=e.inputBuffer.getChannelData(0);if(l.push(new Float32Array(t)),2===b){var a=e.inputBuffer.getChannelData(1);m.push(new Float32Array(a))}p+=r}},o.connect(a),a.connect(i.destination)}function WhammyRecorder(a){var i,o;this.start=function(e){for(var t in e=e||1e3,i=new WhammyRecorderHelper(a,this),this)"function"!=typeof this[t]&&(i[t]=this[t]);i.record(),o=setInterval(function(){i.requestData()},e)},this.stop=function(){i&&(i.stop(),clearTimeout(o))},this.clearOldRecordedFrames=function(){i&&i.clearOldRecordedFrames()},this.pause=function(){i&&i.pause()},this.resume=function(){i&&i.resume()},this.ondataavailable=function(){}}function WhammyRecorderHelper(t,a){this.record=function(e){this.width||(this.width=320),this.height||(this.height=240),this.video&&this.video instanceof HTMLVideoElement&&(this.width||(this.width=d.videoWidth||d.clientWidth||320),this.height||(this.height=d.videoHeight||d.clientHeight||240)),this.video||(this.video={width:this.width,height:this.height}),this.canvas&&this.canvas.width&&this.canvas.height||(this.canvas={width:this.width,height:this.height}),A.width=this.canvas.width,A.height=this.canvas.height,this.video&&this.video instanceof HTMLVideoElement?(this.isHTMLObject=!0,d=this.video.cloneNode()):((d=document.createElement("video")).src=URL.createObjectURL(t),d.width=this.video.width,d.height=this.video.height),d.muted=!0,d.play(),s=(new Date).getTime(),c=new Whammy.Video(a.speed,a.quality),console.log("canvas resolutions",A.width,"*",A.height),console.log("video width/height",d.width||A.width,"*",d.height||A.height),r()};var i=!(this.clearOldRecordedFrames=function(){c.frames=[]}),o=!(this.requestData=function(){if(!l)if(c.frames.length){i=!0;var e=c.frames.slice(0);c.frames=function(e,t,a,i){var o=document.createElement("canvas");o.width=A.width,o.height=A.height;for(var r=o.getContext("2d"),n=[],d=-1===t,s=t&&0<t&&t<=e.length?t:e.length,c={r:0,g:0,b:0},u=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),h=a&&0<=a&&a<=1?a:0,l=i&&0<=i&&i<=1?i:0,m=!1,f=0;f<s;f++){var p,v,g;if(!m){var b=new Image;b.src=e[f].image,r.drawImage(b,0,0,A.width,A.height);var w=r.getImageData(0,0,A.width,A.height);p=0,v=w.data.length,g=w.data.length/4;for(var y=0;y<v;y+=4){var M={r:w.data[y],g:w.data[y+1],b:w.data[y+2]},S=Math.sqrt(Math.pow(M.r-c.r,2)+Math.pow(M.g-c.g,2)+Math.pow(M.b-c.b,2));S<=u*h&&p++}}!m&&g-p<=g*l||(d&&(m=!0),n.push(e[f]))}(n=n.concat(e.slice(s))).length<=0&&n.push(e[e.length-1]);return n}(e,-1),c.compile(function(e){a.ondataavailable(e),console.debug("video recorded blob size:",bytesToSize(e.size))}),c.frames=[],i=!1}else i=!1});function r(){if(l)return s=(new Date).getTime(),void setTimeout(r,500);if(!n){if(i)return setTimeout(r,100);var e=(new Date).getTime()-s;if(!e)return r();s=(new Date).getTime(),!h.isHTMLObject&&d.paused&&d.play(),u.drawImage(d,0,0,A.width,A.height),n||c.frames.push({duration:e,image:A.toDataURL("image/webp")}),o||function(e,t,a){var i=document.createElement("canvas");i.width=A.width,i.height=A.height;var o,r,n,d=i.getContext("2d"),s={r:0,g:0,b:0},c=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),u=t&&0<=t&&t<=1?t:0,h=a&&0<=a&&a<=1?a:0,l=new Image;l.src=e.image,d.drawImage(l,0,0,A.width,A.height);var m=d.getImageData(0,0,A.width,A.height);o=0,r=m.data.length,n=m.data.length/4;for(var f=0;f<r;f+=4){var p={r:m.data[f],g:m.data[f+1],b:m.data[f+2]},v=Math.sqrt(Math.pow(p.r-s.r,2)+Math.pow(p.g-s.g,2)+Math.pow(p.b-s.b,2));v<=c*u&&o++}return!(n-o<=n*h)}(c.frames[c.frames.length-1])||(o=!0,a.onStartedDrawingNonBlankFrames()),setTimeout(r,10)}}var n=!1;this.stop=function(){n=!0,this.requestData()};var d,s,c,A=document.createElement("canvas"),u=A.getContext("2d"),h=this;var l=!1;this.pause=function(){l=!0},this.resume=function(){l=!1}}function GifRecorder(e){if("undefined"==typeof GIFEncoder)throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";function t(){Date.now();var e=new Blob([new Uint8Array(c.stream().bin)],{type:"image/gif"});a.ondataavailable(e),c.stream().bin=[]}this.start=function(e){e=e||1e3;var a=this.videoWidth||320,i=this.videoHeight||240;r.width=d.width=a,r.height=d.height=i,(c=new GIFEncoder).setRepeat(0),c.setDelay(this.frameRate||this.speed||200),c.setQuality(this.quality||1),c.start(),Date.now(),h=requestAnimationFrame(function e(t){o?setTimeout(e,500,t):(h=requestAnimationFrame(e),void 0===typeof s&&(s=t),t-s<90||(d.paused&&d.play(),n.drawImage(d,0,0,a,i),c.addFrame(n),s=t))}),u=setTimeout(t,e)};var o=!(this.stop=function(){h&&(cancelAnimationFrame(h),clearTimeout(u),t())});this.pause=function(){o=!0},this.resume=function(){o=!1},this.ondataavailable=function(){},this.onstop=function(){};var a=this,r=document.createElement("canvas"),n=r.getContext("2d"),d=document.createElement("video");d.muted=!0,d.autoplay=!0,d.src=URL.createObjectURL(e),d.play();var s,c,u,h=null}void 0!==MediaStreamRecorder&&(MediaStreamRecorder.MediaRecorderWrapper=MediaRecorderWrapper),void 0!==MediaStreamRecorder&&(MediaStreamRecorder.StereoAudioRecorder=StereoAudioRecorder),void 0!==MediaStreamRecorder&&(MediaStreamRecorder.StereoAudioRecorderHelper=StereoAudioRecorderHelper),void 0!==MediaStreamRecorder&&(MediaStreamRecorder.WhammyRecorder=WhammyRecorder),void 0!==MediaStreamRecorder&&(MediaStreamRecorder.WhammyRecorderHelper=WhammyRecorderHelper),void 0!==MediaStreamRecorder&&(MediaStreamRecorder.GifRecorder=GifRecorder);var Whammy=function(){function e(e,t){this.frames=[],e||(e=1),this.duration=1e3/e,this.quality=t||.8}function r(e){function c(e,a,t){return[{data:e,id:231}].concat(t.map(function(e){var t=function(e){var t=0;e.keyframe&&(t|=128);e.invisible&&(t|=8);e.lacing&&(t|=e.lacing<<1);e.discardable&&(t|=1);if(127<e.trackNum)throw"TrackNumber > 127 not supported";return[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map(function(e){return String.fromCharCode(e)}).join("")+e.frame}({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(a)});return a+=e.duration,{data:t,id:163}}))}function u(e){for(var t=[];0<e;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function h(e){var t=[];e=(e.length%8?new Array(9-e.length%8).join("0"):"")+e;for(var a=0;a<e.length;a+=8)t.push(parseInt(e.substr(a,8),2));return new Uint8Array(t)}var t=new function(e){var t=function(e){if(e[0]){for(var t=e[0].width,a=e[0].height,i=e[0].duration,o=1;o<e.length;o++)i+=e[o].duration;return{duration:i,width:t,height:a}}postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."})}(e);if(!t)return[];for(var a,i=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(a=t.duration,[].slice.call(new Uint8Array(new Float64Array([a]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:t.width,id:176},{data:t.height,id:186}]}]}]}]}],o=0,r=0;o<e.length;){for(var n=[],d=0;n.push(e[o]),d+=e[o].duration,++o<e.length&&d<3e4;);var s={id:524531317,data:c(r,0,n)};i[1].data.push(s),r+=d}return function e(t){for(var a=[],i=0;i<t.length;i++){var o=t[i].data;"object"==typeof o&&(o=e(o)),"number"==typeof o&&(o=h(o.toString(2))),"string"==typeof o&&(o=new Uint8Array(o.split("").map(function(e){return e.charCodeAt(0)})));var r=o.size||o.byteLength||o.length,n=Math.ceil(Math.ceil(Math.log(r)/Math.log(2))/8),d=r.toString(2),s=new Array(7*n+7+1-d.length).join("0")+d,c=new Array(n).join("0")+"1"+s;a.push(u(t[i].id)),a.push(h(c)),a.push(o)}return new Blob(a,{type:"video/webm"})}(i)}(e.map(function(e){var t=function(e){for(var t=e.RIFF[0].WEBP[0],a=t.indexOf("Â*"),i=0,o=[];i<4;i++)o[i]=t.charCodeAt(a+3+i);return{width:16383&(o[1]<<8|o[0]),height:16383&(o[3]<<8|o[2]),data:t,riff:e}}(function e(t){for(var a,i=0,o={};i<t.length;){var r=t.substr(i,4),n=(a=i,parseInt(t.substr(a+4,4).split("").map(function(e){var t=e.charCodeAt(0).toString(2);return new Array(8-t.length+1).join("0")+t}).join(""),2)),d=t.substr(i+4+4,n);i+=8+n,o[r]=o[r]||[],"RIFF"===r||"LIST"===r?o[r].push(e(d)):o[r].push(d)}return o}(atob(e.image.slice(23))));return t.duration=e.duration,t}));postMessage(t)}return e.prototype.add=function(e,t){if("canvas"in e&&(e=e.canvas),"toDataURL"in e&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},e.prototype.compile=function(t){var e,a,i,o=(e=r,a=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),i=new Worker(a),URL.revokeObjectURL(a),i);o.onmessage=function(e){e.data.error?console.error(e.data.error):t(e.data)},o.postMessage(this.frames)},{Video:e}}();void 0!==MediaStreamRecorder&&(MediaStreamRecorder.Whammy=Whammy),window.ConcatenateBlobs=function(a,o,r){var n=[],i=0;!function t(){if(!a[i])return function(){var t=0;n.forEach(function(e){t+=e.byteLength});var a=new Uint16Array(t),i=0;n.forEach(function(e){var t=e.byteLength;t%2!=0&&(e=e.slice(0,t-1)),a.set(new Uint16Array(e),i),i+=t});var e=new Blob([a.buffer],{type:o});r(e)}();var e=new FileReader;e.onload=function(e){n.push(e.target.result),i++,t()},e.readAsArrayBuffer(a[i])}()},"undefined"!=typeof module&&(module.exports=MediaStreamRecorder),"function"==typeof define&&define.amd&&define("MediaStreamRecorder",[],function(){return MediaStreamRecorder});
